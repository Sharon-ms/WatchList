SET FOREIGN_KEY_CHECKS = 0;
-- מחיקת כל הטבלאות
DROP DATABASE watchlist;
-- יצירת הדאטאבייס מחדש
CREATE DATABASE watchlist;
SET FOREIGN_KEY_CHECKS = 1;



-------
-- יצירת טבלת סדרות
CREATE TABLE series (
    id INT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    genre VARCHAR(100),
    image VARCHAR(255),
    year INT,
    createdAt DATETIME NOT NULL,
    updatedAt DATETIME NOT NULL
);

-- יצירת טבלת עונות
CREATE TABLE seasons (
    id INT AUTO_INCREMENT PRIMARY KEY,
    seriesId INT NOT NULL,
    seasonNumber INT NOT NULL,
    createdAt DATETIME NOT NULL,
    updatedAt DATETIME NOT NULL,
    FOREIGN KEY (seriesId) REFERENCES series(id) ON DELETE CASCADE
);

-- יצירת טבלת פרקים
CREATE TABLE episodes (
    id INT AUTO_INCREMENT PRIMARY KEY,
    seasonId INT NOT NULL,
    title VARCHAR(255) NOT NULL,
    createdAt DATETIME NOT NULL,
    updatedAt DATETIME NOT NULL,
    FOREIGN KEY (seasonId) REFERENCES seasons(id) ON DELETE CASCADE
);

-- יצירת טבלת משתמשים
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    createdAt DATETIME NOT NULL,
    updatedAt DATETIME NOT NULL
);

-- יצירת טבלת מעקב צפייה בפרקים
CREATE TABLE watchedEpisodes (
    id INT AUTO_INCREMENT PRIMARY KEY,
    userId INT NOT NULL,
    episodeId INT NOT NULL,
    watched BOOLEAN DEFAULT FALSE,
    watchedAt DATETIME DEFAULT CURRENT_TIMESTAMP,
    createdAt DATETIME NOT NULL,
    updatedAt DATETIME NOT NULL,
    FOREIGN KEY (userId) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (episodeId) REFERENCES episodes(id) ON DELETE CASCADE
);

-- יצירת טבלת מעקב משתמשים לפי סדרות
CREATE TABLE userSeries (
    id INT AUTO_INCREMENT PRIMARY KEY,
    userId INT NOT NULL,
    seriesId INT NOT NULL,
    createdAt DATETIME NOT NULL,
    updatedAt DATETIME NOT NULL,
    FOREIGN KEY (userId) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (seriesId) REFERENCES series(id) ON DELETE CASCADE
);
